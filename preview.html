<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bio.toast Preview</title>
</head>
<body>
    <h1>bio.toast - Bio for Developers</h1>
    <p>You can preview how your <code>styles.css</code> and <code>bio.toast.json</code> applies to your <a href="https://github.com/lightly-toasted/bio.toast">bio.toast</a> page.</p>
    <p>To refresh, use Back button (&#x2B05;) in your web browser or <button>Reload</button> button at the bottom of the preview page.</p>
    <button disabled id="start">Start (not working atm)</button>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        function toBase64(str) {
            const encoder = new TextEncoder();
            const bytes = encoder.encode(str);
            const base64 = btoa(String.fromCharCode(...bytes));
            return base64;
        }
        async function preview() {
            const styles = await fetch('/styles.css')
            const config = await fetch('/bio.toast.json')
            const encodedStyles = toBase64(await styles.text())
            const encodedConfig = toBase64(await config.text())
            const username = (await config.json()).name || 'lightly-toasted'

            window.location.href = `https://bio.toast.name/${username}?preview=${encodedStyles}|${encodedConfig}`
        }
        if (urlParams.has('reload')) preview()
        document.getElementById('start').addEventListener('click', function() {
            urlParams.append('reload', '');
            const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
            window.history.replaceState(null, '', newUrl);
            preview()
        });
    </script>
</body>
</html>